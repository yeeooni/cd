# 교착상태와 기아상태(1)

1. 교착상태 개요
- 교착상태(DeadLock)의 개념
> 시스템 측면에서 자원의 요구가 뒤엉킨 상태를 말한다.  
한 프로세스 집합 내의 프로세스들에 의해 발생할 사건(Event)를 프로세스들이 서로 기다리고 있는 상태  
둘 이상의 작업이 보류 상태에 놓여 중요한 자원을 이용하기 위해 기다릴 때 발생한다.  
제한된 자원 이용률을 높이고 시스템 효율성을 증가시키기 위해 사용하는 병행처리기술과 자원 공유에 따른 부작용이다.

- 초기 일괄처리시스템
> 사용자들이 작업제어카드에 작업을 완료하기 위해 필요한 자원을 명시하여 교착상태가 자주 발생하지 않는다.  
운영체제가 요청한 자원이 준비 큐로 이동하기 전 사용 가능 여부를 확인하여 할당한다.  
자원이 확보되지 않으면 작업이 준비 큐로 이동할 수 없어 교착상태가 발생하지 않는다. 

---
- 대화식시스템
> 동적 자원 공유로 자원의 이용도를 높이는 과정에서 교착상태 발생!
  - DVD 드라이브와 프린트가 각각 하나씩 존재하고 다음과 같은 경우
    - 프로세스 P : DVD 드라이브 점유 >> 프린터 요청
    - 프로세스 Q : 프린터 점유 >> DVD 드라이브 요청
  - 테이프 드라이브가 3개 존재하고 다음과 같은 경우
    - 프로세스 P : 테이프 드라이브 점유
    - 프로세스 Q : 테이프 드라이브 점유
    - 프로세스 R : 테이프 드라이브 점유

---
- 프로세스는 다음순서로 자원을 이용한다.
  - 요청 : 프로세스가 자원을 요청한다. 요청을 즉시 받아들여지지 않으면 다른 프로세스가 사용 중이므로 할당 받을 때까지 대기한다.
  - 사용 : 프로세스가 요청한 자원을 사용한다.
  - 해제 : 프로세스가 자원 사용을 마친 후, 할당 받은 자원을 되돌려준다.
    - 자원의 요청과 해제 그리고 파일이나 입출력 장치를 읽거나 쓰는 자원의 사용도 시스템 호출에 의해 이루어진다.
    - 운영체제는 프로세스가 자원 요청 시, 할당 받을 수 있도록 항상 확인하고 기록한다.
---
- 교착상태 발생
> 파일을 요청할 때의 교착상태  
파일을 이용해 작어빙 실행되는 동안, 파일에 대한 다른 작업의 점유 요청이 인정되면 교착상태 발생
- 파일 요청 시 발생하는 교착상태
  - 두 개의 프로세스(판매, 재고)와 두 개의 파일 (공급자 파일, 재고 파일) 자원을 이용한 교착상태 표현

- 할당 요구 순서
  - 프로세스 1 (판매)는 판매 계획을 위해 공급자 파일을 요청해서 얻는다.(할당)
  - 프로세스 2 (재고)는 재고 확인을 위해 재고 파일을 요청해서 얻는다. (할당)
  - 프로세스 1은 주문 요청한 판매를 위해 재고 파일을 요청하지만 허용되지 않는다.
  - 프로세스 2는 주문을 위해 공급자 파일을 요청하지만 허용되지 않는다.

- 전용장치를 할당할 때의 교착상태
  - 전용장치 할당 시 발생하는 교착상태
    - 두 사용자(프로세스 1, 프로세스 2)가 각각 테이프 드라이브 한 대를 사용하고, 한 테이프에서 다른 테이프로 복사하는 작업을 할 경우
    - 할당 요구 순서는 다음과 같이 이루어진다 가정
> 프로세스 1은 테이프 드라이브 1을 요청해서 얻는다. (할당)  
프로세스 2는 테이프 드라이브 2를 요청해서 얻는다. (할당)  
프로세스 1는 테이프 드라이브 2를 요청하지만 허용되지 않는다.  
프로세스 2는 테이프 드라이브 1을 요청하지만 허용되지 않는다.

---
- 스풀링 시스템에서의 교착상태
> 스풀링 시스템에서 디스크에 할당된 스풀 공간의 출력이 완료되지 않은 상태에서 다른 작업이 스풀 공간을 모두 차지하면 교착상태가 발생  
스풀링 처리부(Input Sppoler)에 필요량보다 많은 공간을 배당하여 교착상태 발생률을 줄일 수 있으나 비용이 많이 든다.  
스풀링 파일이 '일정 포화 임계치(Saturation Treshold)'를 설정하여 교착상태를 예방할 수 있으나 시스템의 처리량이 줄어들 수 있다.

---
- 디스크를 공유할 때의 교착상태
> 디스크는 대표적인 공유 자원으로, 사용에 대한 제어가 없다면 교착상태가 발생할 수 있다.

- 네트워크에서의 교착상태
> 네트워크가 붐비거나 입출력 버퍼공간이 부족한 네트워크 시스템이 메시지 흐름을 제어하는 적절한 프로토콜을 가지지 못한 경우 교착상태 발생

---
- 교착상태 발생조건
> 상호배제 : 자원이 최소 하나 이상 비 공유, 즉 한번에 한 프로세스만 해당 자원을 사용할 수 있어야한다. 사용 중인 자원을 다른 프로세스가 사용하려면 요청한 자원이 해제 될 때 까지 대기해야한다.  
점유와 대기 : 최소한 자원 하나를 보유하고 다른 프로세스에 할당된 자원을 얻기 위해 기다리는 프로세스가 있어야한다.  
비선점 : 자원은 선점될 수 없다. 즉 자원을 강제로 뺏을 수 없으며 자원을 점유하고 있는 프로세스가 끝나가 있어야한다.  
순환대기 : 대기 프로세스 집합이 있을 때 보유하고 있는 자원을 각각 얻기 위해 대기하는 경우 
- 강건너기 교착상태
  - 여러 개의 돌로 된 징검다리가 있는 강을 건너는 경우
  - 징검다리의 둘 하나는 한 쪽에서 한 사람만 디딜 수 있다. (상호배제 성립)
  - 강을 건너는 사람을 프로세스, 징검다리의 돌을 자원이라 가정한다.
  - 두 사람이 동시에 서로 다른 방향에서 출발, 강 중간에서 만나면 교착상태가 발생했다 할 수 있다.
  - 돌을 딛는 것을 자원 할당, 발을 떼는 것을 자원 해제로 볼 때 동시에 같은 돌을 딛이려 하면 교착상태가 발생한다.
  - 각 사람은 돌 하나를 딛고 다음 돌을 요구한다. (점유와 대기 조건 만족)
  - 사람이 딛고 있는 돌을 강제로 제거할 수 없다. (비선점 조건 만족)
  - 왼쪽에서 오는 사람은 오른쪽 사람을, 오른쪽에서 오는 사람은 왼쪽 사람을 기다린다. (순환대기 조건 만족)

- 해결 방법
  - 둘 중 한 사람이 되돌아간다. (복귀)
  - 강을 건너기 전에 상대편 강 쪽을 확인하고 출발한다.
  - 강의 한 쪽 편에 우선권을 부여한다.

