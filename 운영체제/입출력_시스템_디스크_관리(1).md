# 입출력 시스템, 디스크 관리(1)

- 컴퓨터 시스템의 입출력 장치와 입추력 모듈을 포함

  - 물리적 입출력 장치는 실제 입출력을 수행한다.
  - 입출력 모듈은 내부 저장장치와 물리적 입출력 장치(외부 입출력장치) 사이의 2진 정보를 전송하기 위한 방법을 제공한다.
    - 입출력 장치의 물리적 특성으로부터 프로세서를 독립시켜 제어한다.

- 입출력 모듈

  - 프로세서를 대신하여 입출려과 관련된 복잡한 일을 수행한다.

    - 입출력 채널(I/O Channel), 입출력 프로세서(I/O Processor)라 한다.

  - 단순히 프로세서의 입출력과 관련된 일 담당

    - 입출력 제어기(I/O Contoller), 장치 제어기(Device Controller)라 한다.
    - 입출력 모듈을 통해 시스템 버스에 연결 된다. 입출력 장치에 따라 제어 방법과 운용방식이 다르므로 입출력 모듈을 통해 연결 된다.
    - 프로세서와 입출력 장치의 실행속도가 다르므로, 각 입출력 장치의 실행속도를 맞추는 과정이 필요하다.
      - 장치들을 동기화 시키지 못하면 실행속도가 다르기 때문에 데이터의 손실이 발생할 수 있다.
    - 정보의 단위와 처리량도 동기화해야한다.
      - 컴퓨터 내부의 정보 단위는 워드이며, 입출력 장치가 다루는 정보의 단위는 문자이다.
      - 프로세서보다 입출력 장치의 처리속도가 느리므로 시간의 낭비가 발생될 수 있다.

  - 구성

    - 입출력 모듈로 들어가거나 나오는 데이터는 일시적으로 데이터 레지스터에 저장된다.
    - 현재의 상태정보가 저장되는 상태 레지스터는 프로세서에서 보내는 제어 정보를 받기 위해 제어 레지스터로 동작한다.
    - 제어 레지스터는 프로세서로부터 받은 명령에 따라 자신이 제어하는 각 장치와의 인터페이스를 위한 입출력 논리회로를 가진다.
    - 신호선(시스템 버스선)을 통해 컴퓨터 내의 다른 부분들과 연결, 모듈 내의 입출력 논리 회로는 제어선을 통해 프로세서와 교신(프로세서가 입출력 모듈로 명령을 보내는데 사용)한다.

  - 기능

    - 입출력 장치의 제어
      - 내부 자원들과 데이터 입출력을 비롯한 다양한 동작 조정을 위한 제어와 타이밍 기능 제공
      - 프로세서가 입출력 장치에 명령어를 보내려면 입출력 장치의 식별자를 주소로 지정해야 한다.
      - 주소 지정 방법은 전용 입출력 주소 방식과 메모리 사상 주소 방식이 있다.
    - 프로세서와 통신
      - 입출력 모듈은 프로세서로부터 수행해야 할 명령어를 전달 받고 관련된 메시지를 인식하기 위한 기능을 제공한다.
      - 메시지 인식을 위해 명령 해독, 데이터 교환, 상태 보고, 주소 인식 등의 과정을 거친다.

    - 데이터 버퍼링
      - 메인 메모리나 프로세서의 데이터 전송률은 높으나, 입출력 장치의 전송률은 낮다.
      - 데이터는 입출력 모듈 내에 일시적으로 저장되었다가 적절한 속도로 주변 장치로 내보내야한다.
      - 반대 방향으로 데이터를 보낼 떄는 메인 메모리 등이 느린 전송률에 영향을 받지 않도록 데이터를 일시 저장할 수 있는 버퍼를 제공, 데이터를 전송한다.
    - 오류 검출
      - 기계적 오류, 전송 오류 등이 있으며, 전송 오류 검출을 위해 오류 검출 코드(패리티 비트)를 사용한다.

- 프로그램 제어 입출력

  - 프로세서 내부에 있는 입출력 데이터, 주소 레지스터를 입출력 모듈과 연결한 형태
  - 주소 레지스터와 버스 사이에서 데이터를 직접 전송할 수 있는 가장 간단한 형태
  - 폴링(Polling) 방식 (바쁜 대기)라고도 한다.
  - 상대적으로 프로세서보다 느린 입출력 장치의 입출력 동작 상태를 확인하기 위해 상태비트(Status Bit)를 주기적으로 검사한다.
  - 데이터 전송 시, 폴링 순환 수행
    - 프로세서는 주변 장치에 전송할 데이터가 있는 경우, 입출력 장치가 데이터를 받을 준비가 되어 있는지 확인 하기 위해 포트 상태 레지스터를 확인한다.
    - 플래그를 검사하여 입출력 장치가 준비되어 있다면 데이터를 전송한다.
    - 준비 되어 있지 않다면 루프를 돌아 다시 포트 상태 레지스터를 확인한다.
  - 폴링의 횟수는 데이터 전송의 성능에 영향을 끼친다.
    - 폴링이 너무 빈번히 수행되면 프로세서는 입출력 동작의 진행 여부 검사에 많은 시간을 낭비한다.
    - 폴링 횟수가 너무 작으면 입출력 장치는 오랜 시간 동안 쉬게 된다.
  - 입력된 데이터는 입출력(인터페이스) 모듈을 거쳐 한 번에 한 워드씩 입출력 데이터 레지스터로 전송한다.
  - 입출력 데이터 레지스터에서는 프로그램에 의해서 데이터를 산술논리연산장치(누산기)로 전송한다.
    - 출력의 경우, 입력과 반대로 전송된다.
  - 모든 데이터 전달은 프로세서의 입출력 명령어에 따른다.
    - 입출력 장치는 메모리를 직접 액세스할 수 없다.
    - 명령어 수행에 따른 프로세서의 역할이 요구되어 프로세서의 부담이 크다.
  - 프로세서 제어 입출력 시스템의 경우 데이터 처리 속도가 느리다. 명령어 인출과 실행 사이클이 모든 데이터의 입출력이 종료된 후에 실행된다.
    - 프로그램 제어 입출력 방식은 저속 장치(키보드, 프린터, 모니터 등)에 적합하다.

- 인터럽트 기반 입출력 : 외부 입력 제어

  - 입출력 장치가 작업을 완료한 후 작업과 관련된 상태와 결과를 메모리에 저장, 인터럽트를 발생 시켜 프로세서에 알린다.
  - 인터럽트를 받은 프로세서는 입출력 명령어를 전송, 입출력 작업 중에 다른 작업을 시작할 수 있다.
  - 프로세서가 입출력 장치에 프로세서의 도움이 필요한지 확인하는 절차 대신 직접 입출력 장치가 프로세서에 신호를 주는 방식
  - 불규칙적이고 빠른 응답성을 요구하는 경우에 적합하다.

- 장 단점

  - 프로세서는 폴링 절차를 생략하여 입출력 연산의 대기시간을 소모할 필요가 없어 효율성이 증가한다.
  - 현재의 작업 내용을 스택에 저장한다는 오버헤드가 존재한다.
  - 모든 데이터가 프로세서의 레지스터에서 전송된다.

- DMA(Direct Memory Address) 입출력

  - 프로세서의 부담을 줄이기 위해, 메인 메모리를 직접 제어하여 데이터를 전송한다.

    - 프로세서는 읽기 및 쓰기 정보를 비롯한 입출력 주소와 메모리 주소 그리고 길이를 DMA 제어기에 전달( 입출력 요청)
    - DMA 제어기는 버스 관리자(Master) 로서 직접 작업을 처리한다.

  - 프로세서에서 입출력 장치로 데이터를 블록 단위로 전송 가능

    - 제어는 입출력 모듈에서 담당, 전송은 프로그램 제어 입출력이 담당한다.
    - 전송이 완료되면, 출력 모듈은 프로세서에서 인터럽트를 발생하여 종료를 통보한다. 데이터를 메모리에 보관한다.

  - 고속 디스크의 데이터 전송에 적합한 방식으로, 멀티미디와 같은 대용량 데이터 전송에 적합하다.

  - DMA 제어기

    - 버스 시스템이 하나인 마이크로 컴퓨터에서 입출력이 진행되는 동안 모든 버스 제어 신호를 생성, 전송하는 버스 마스터 역할을 수행한다.
    - 프로세서보다 우선 순위가 높으므로, 프로세서가 DMA 제어기가 버스를 사용하지 않을 때 버스를 사용할 수 있다.
    - 프로세서가 버스를 사용하기 위해 기다리는 현상을 'DMA 제어기는 프로세서로 부터 버스 사이클을 스틸한다.'라고 한다.

  - 사이클 스틸링(Cycle Stealing)

    - 프로세서와 DMA 제어기가 입출력을 위해 동시에 메모리를 액세스하는 경우, DMA 제어기가 우선적으로 메모리 참조 사이클을 수행하여 입출력을 수행한다.
    - 입출력 장치가 시스템 버스, 저장 시스템과 같은 분할 자원을 독점적으로 액세스하려 하기 때문에 생기는 현상
    - 프로세서의 속도를 떨어뜨리나 입출력 작업을 DMA에 전담시킴으로써 시스템 전체 성능은 향상된다.

  - 직접 사상 주소 액세스 (DVMA, Direct Virtual Memory Access)

    - 프로세서나 메모리의 도움 없이 가상 주소를 이용하여 두 개의 메모리 맵 장치 간에 데이터 전송 가능

    - 입출력 채널 : ibm에서 제작된 컴퓨터에서 이러한 기능을 갖는 입출력 처리기 

      - 채널이라 부르는 단순한 입출력 프로세서를 이용

      - 채널 프로그램이라 불리는 프로그램의 제어를 통해 DMA 입출력을 수행

      - 모든 입출력 동작이 완료된 시점에서 인터럽트 받는, 프로세서와 메인 메모리를 입출력 장치와 결합하여 프로세서의 명령으로 입출력을 제어하는 장치

      - 프로그램 : 제어 입출력과 직접 메모리 액세스 방법의 특징 비교,

        - 제어 입출력

          - 프로세서가 계속 제어하므로, 입출력 장치와 컴퓨터를 연결하는 데 최소한의 하드웨어만 필요
          - 저속 장치들에서 사용된다.
          - 직접 메모리 액세스
          - 매개변수의 초기화를 제어하고 프로세서를 모든 입출력 연산과 분리, 데이터 전달을 제어하기 위해 외부 제어기가 필요하다.
          - 고속의 장치에서 사용된다.

        - 입출력 전용 처리기

          - 대형 컴퓨터에서 프로세서를 좀 더 효율적으로 이용하기 위해 사용된다.
          - 다수의 장치를 공유할 수 있다.
          - 입출력 동작 명령어를 가진 프로세서를 포함하여 다른 프로세서의 도움 없이 입출력 프로그램의 입출력 동작을 지시한다.
          - 지역 기억 장치(Local Memory)를 가지며 사실상 하나의 컴퓨터라 할 수 있다.
          - 프로세서의 개입이 최소화된 상태에서 많은 입출력 장치를 제어, 입출력 프로세서로 불린다.

        - 입출력 채널을 사용하는 컴퓨터 구조의 예)

          - 채널 서브 시스템은 여러개로 구성 가능, 프로세서와 메인 메모리의 액세스를 조정
          - 채널은 사이클 스틸을 사용하여 메모리에 직접 액세스 한다.
          - 각 입출력 장치는 제어장치를 통해 채널과 연결된다.
          - 제어장치는 채널과의 통신 및 장치에 대한 제어기능을 수행한다.
          - 유사한 장치들에 대해 하나의 제어장치가 사용되며, 한 순간에 한 장치만 활성화된다.

        - 특성

          - DMA 개념을 확장하여 입출력 명령어들을 실행할 수 있는 능력을 가진다.
            - 입출력 동작들에 대하여 완전한 제어권을 가진다.
            - 컴퓨터시스템에서 프로세서가 입출력 명령어를 실행하지 않아도 입출력 데이터가 메인 메모리에 저장된다.
          - 입출력 채널 내에 있는 특수 목적용 프로세서에 의해 실행된다.
            - 프로세서는 입출력 채널이 메인 메모리에 있는 프로그램을 실행하도록 지시하여 입출력 전송을 실행
            - 입출력 채널은 메인 메모리에 저장된 명령어들을 실행하면서 데이터 전송을 제어한다.

        - 형태

          - 셀렉터 채널 

            - 어떤 장치에 대한 입출력이 종료될 때까지 다른 장치를 실행하지 않는다.
            - 고속 장치들은 멀티플렉서 채널을 사용해 고속으로 데이터를 전송, 다른 장치들과 다중화하기 어렵다.
            - 한 번에 하나씩 처리하는 전용 채널을 이용해 다중화 할 수 있다.

          - 멀티플렉서 채널

            - 바이트 단위로 시분할하여 여러 장치의 출력을 처리하므로 바이트 멀티플렉서 채널이라고  한다.
            - 다수의 저속/중속 장치들을 연결할 때 사용한다.
            - 채널 - 메모리 링크는 장치와 채널 사이의 데이터 전달 속도 보다 더 빠른 속도로 데이터를 전달 가능하므로 속도가 느린 다수의 입출력 장치를 동시에 동작 시킬 수 있다.

          - 블록 멀티플렉서 채널

            - 셀렉터 채널, 멀티플렉서 채널의 장점을 결합, 여러 대의 고속 입출력 장치들을 블록 단위로 처리
            - 동일한 채널에서 여러 고속장치가 활성화 할 수 있다.
            - 채널 명령어는 하나의 장치와 입출력 명렁어를 수행한 후 별도의 지시가 없어도 자동으로 다른 장치와 명령을 수행하도록 변환된다.
            - 한 채널이 복수의 입출력 장치에 의해 시분할 방식으로 사용될 수 있으나, 어떤 경우 하나의 장치에만 서비스하므로 셀렉터 채널과 유사하다.
            - 멀티플렉서 채널과 같이 다른 장치에 대한 서비스를 완료할 때 까지 기다릴 필요가 없다.

            

  - 커널 입출력 서브 시스템

  - 입출력 서비스와 입출력 인터페이스 실행을 위해 인터페이스 구성

  - 커널 입출력 구조

    - 입출력 장치의 모델이나 제조사와 관계없이 공통적인 특성을 가진 입출력 장치들을 액세스하기 위해 필요한 표준함수들을 정의한다.
    - 정의된 함수들은 장치 드라이버에 의해 수행된다.
      - 장치 드라이버는 여러 입출력 장치의 차이를 간단한 표준 인터페이스로 변환하여 상위의 커널 입출력 서브 시스템에 제공한다.

    _커널은 입출려과 관련된 서비스를 제공하며, 커널 입출력 서브시스템은 컴퓨터의 효율성 증진을 위해 메모리나 디스크의 기억장소를 이용한다._

  - 커널 입출력 스케줄링

    - 입출력 요구를 스케줄링 : 요구들의 실행 순서를 결정한다.
    - 응용 프로그램은 입출력을 요청한 순서대로 실행하기 보다 전반적인 시스템 성능을 향상시키면서 프로세서들의 요구를 공평하게 처리할 수 있도록 순서를 결정한다.

  - 커널 입출력 버퍼링

    - 버퍼링을 통해 송신자와 수신자의 전송 속도 차이 때문에 발생하는 시스템의 데이터 전송 문제를 해결 가능
    - 장치들이 보내는 데이터의 크기가 다르기 떄문에 발생하는 메시지 전송 문제를 해결 가능
    - 대부분의 전송 메시지는 작은 네트워크 패킷으로 나누어 전송, 수신측에서 원래의 자료로 복원하기 위해 패킷들을 버퍼에서 결합
    - 버퍼링의 구조
      - 입출력 장치에서 들어온 데이터를 모뎀을 통해 디스크에 저장(기록)한다고 가정한다.
        - A : 입출력 장치의 모뎀에 버퍼가 없으므로 데이터의 입력 속도에 따라 디스크에 저장한다.
        - B : 시스템 성능 향상을 위해 메모리에 버퍼를 만든다.
        - C : 두 개의 버퍼를 사용한다. (이중 버퍼링)

  - 커널 입출력 캐싱

    - 명령어와 데이터를 캐시 메모리에 일시적으로 저장. 프로세서와 메모리(디스크)간의 액세스 속도 차를 프로세서에 가깝게 단축 시켜 컴퓨터의 성능을 향상시킨다.
      - 캐시 : 버퍼와 다르게 자주 사용될 자료를 미리 복사하여 저장하는 빠른 메모리 영역 다른 곳에 저장되어 있는 데이터의 복사본을 저장하는 장소
    - 한 메모리 영역이 두 가지 목적을 위해 사용 (캐싱, 버퍼링)
      - 커널이 데이터 입출력 요구를 받으면, 커널은 먼저 데이터가 캐시에 있는지 조사
      - 데이터가 캐시에 있으면 디스크 입출력을 생략, 입출력의 효율성을 높인다.
      - 메모리 내에 버프를 사용하여 디스크 입출력 스케줄링을 효율적으로 수행 OR 프로세스들 간에 공유해야하는 파일들을 위한 캐시로 사용 가능

  - 커널 입출력 스풀링

    - 여러 응용 프로그램이 동시에 출력 데이터를 프린터로 전송 시 커널(운영체제)는 각 출력이 다른 프로그램의 출력과 섞이지 않고 프린터로 출력되도록 관리한다.
      - 각 응용 프로그램의 출력은 각각 대응 되는 디스크 파일에 저장(스풀)된다.
    - 스풀링 시스템
      - 응용 프로그램이 출력 데이터에 대한 작업을 종료하면 그때까지 모아 놓은 출력 데이터를 프린터 출력용 준비 큐에 삽입(이동)하여 스풀 파일을 한 번에 하나씩 프린터에 내보낸다.
      - 커널 스레드에 의해 처리

  - 오류 처리

    - 커널(운영체제)는 입출력 장치나 네트워크 전송의 원인으로 발생되는 일시적인 고장을 효과적으로 극복 가능
    - 중요한 구성 요소가 영구적인 고장을 일으키는 경우 문제를 완전히 극복하기 어렵다.

  - 자료 관리

    - 커널은 입출력 구성에 대한 상태 정보를 유지한다.
    - 입출력 서비스를 커널이 아닌 독립 프로그램이 담당 할 경우의 장단점
      - 오버헤드가 증가한다.
      - 입출력 시스템의 구조가 설계가 간단해지며, 운영체제 커널의 크기가 작아지고 유연셩이 좋아진다.
    - 입출력 서브시스템은 광범위한 서비스를 조정, 다음 사항을 관리한다.
      - 장치의 이름 및 장치에 대한 액세스 제어 관리
      - 장치 할당과 입출력 스케줄링 관리
      - 버퍼링, 캐싱 및 스풀링 관리
      - 장치 상태 모니터링과 오류 처리 및 고장 복구 관리

  

- 자가 디스크의 물리적 구조

  - 원판 모양, 표면에 자기 물질이 입혀져 있으며 이곳에 정보 기록 저장
  - 디스크가 사용 중일 때 구동 모터는 빠른 속도로 디스크를 회전시키고 디스크 표면 바로 위에 입출력 헤드가 위치한다.
    - 논리적으로 디스크 표면은 트랙으로 나누어진다.
    - 입출력 헤드 아래의 트랙에 정보가 자기적으로 기록되며, 디스크의 한 표면은 수백개의 트랙으로 구성된다.
  - 고정 헤드와 자기 디스크 장치
    - 고정 헤드 디스크 : 트랙마다 각각의 헤드가 있다.
    - 자기 디스크 : 한 개의 헤드와 헤드를 이동시키는 하드웨어로 구성
  - 높은 성능 요구 시 고속 디스크, 램 디스크를 사용하여 조앨의 이동 헤드 디스크보다 빠른 액세스와 데이터 전송 가능
  - 디스크 표면에 저장 밀도를 높이거나 트랙 수 증가 가능 / 디스크의 저장 능력 향상
  - 자기 디스크 장치
    - 한 개의 회전 축에 여러 개의 디스크를 쌓고 한 개의 구동모터로 회전, 디스크마다 각각의 입출력 헤드로 처리 가능.
    - 디스크는 교체 가능하므로 필요에 따라 다른 디스크를 장치하여 사용 가능

- 디스크 시스템은 디스크 드라이버, 프로세서, 디스크 제어기로 구분

  - 디스크 드라이버
    - 구동 모터, 액세스 암 이동장치와 입출력 헤드 부분이 기계적인 부분 담당
    - 탐색, 기록, 판독 등의 명령 수행
  - 프로세서
    - 원하는 컴퓨터의 논리적인 상호작용, 즉 원하는 데이터의 위치(디스크 주소), 버퍼 및 판독 / 기록 관리 등을 관리
  - 디스크 제어기
    - 디스크 드라이버의 인터페이스 역할 담당
    - 프로세서로부터 명령을 받아 디스크 드라이버를 동작
  - 디스크 상의 정보는 드라이버 번호, 표면 번호 및 트랙 번호 등 여러 부분으로 나뉘어지는 디스크 주소에 의해 참조
    - 정보는 블록 단위로 입출력
  - 실린더
    - 헤드의 움직임 없이 액세스할 수 있는 하나의 드라이버상의 모든 트랙
  - 섹터
    - 트랙 내의 정보는 블록으로 이루고, 이러한 블록이 하드웨어적으로 고정된 크기를 가진 경우
    - 각 섹터는 독립적으로 입출력 될 수 있다.
    - 섹터는 디스크로부터 입출력이 가능한 정보의 가장 작은 단위

  _디스크 드라이브의 섹터 크기는 32 ~ 4096byte 트랙당 4 ~ 32 섹터, 디스크 표면 당 20 ~ 1500 트랙으로 구성된다._

- 디스크 액세스 시간

  - 탐색 : 디스크상의 원하는 섹터에 액세스 하기 위해 헤드를 해당 트랙 or 실린더로 이동해 위치
  - 탐색 시간 : 탐색에 걸리는 시간 / 디스크의 헤드가 움직이는 시간에 좌우되므로 멀리 떨어진 트랙 탐색 시 길어진다.
  - 회전 지연 시간 : 원하는 섹터가 입출력 헤드 아래로 회전할 때를 기다리는 시간
  - 전송 시간 : 디스크와 메인 메모리 간의 섹터를 주고받는 데 걸리는 시간
  - 고정 헤드 디스크의 데이터 액세스 시간
    - 각 트랙에 읽기, 쓰기, 헤드를 가지고 있어 탐색 시간이 필요 없다.
    - 회전 지연 시간  + 전송 시간
    - 이동 디스크의 데이터 액세스 시간
      - 탐색 지연 시간 + 회전 지연 시간 + 전송 시간
    - 데이터 액세스 시간 예)
      - 다음 과 같은 조건에서 전송 크기가 1kb 일 때,
      - 탐색 시간 : 50 ms
      - 디스크 회전 지연 시간 : 16.5ms
      - 전송 시간 : 0.00095ms/byte ( 1kb 전송 시간 : 0.96256(=0.00064 * 1024))
    - 이동 디스크와 고정 헤드의 데이터 액세스 시간 계산
      - 이동 디스크의 데이터 액세스 시간 : 50 + 16.8  + 0.96256
      - 고정 헤드의 데이터 액세스 시간 : 16.8 + 0.96256
  
- 특정 섹터의 주소

  - 메모리와 디스크 사이에 입출력 전송은 하나 또는 여러 개의 섹터 단위로 이루어진다.
  - 디스크는 섹터들의 3차원 배열로 볼 수 있다.
    - 특정 섹터의 주소를 만들기 위해 트랙번호(실린더), 표면 번호, 섹터 번호 등이 필요하다.
    - 트랙 당 섹터들의 개수를 s로 표시, 실린더 당 트랙들의 개수를 t로 표시할 때, 
      - 실린더 번호 i, 표면 번호 j, 섹터 번호 k 인 디스크 주소는 1차원 블록 수 b로 표시 가능
      - 사상에서 블록 b + 1 을 액세스할 때, b가 실린더의 마지막 블록
      - b + 1블록 (실린더)에 대한 탐색이 필요하며, 이 경우 헤드가 단지 한 트랙만 옮기면 된다.
    - 디스크는 디스크 내에 어떤 파일이 있는지를 표시하는 장치 디렉터리를 가진다.
      - 장치 디렉터리는 파일 이름으로 목록을 나타낸다.
      - 파일이 디스크의 어디에 있는지, 즉 파일의 길이, 종류, 소유주, 생성된 날짜, 마지막으로 사용된 시간 그리고 부호 등에 대한 정보를 포함한다.