# 교착상태와 기아상태(2)

1. 교착상태 탐지
- 교착상태 탐지 알고리즘
> 쇼사니와 포크만이 제안  
다음과 같은 자료구조들을 사용한다.

- Available : 자원 형태마다 사용 가능한 자원 수를 표시하는 길이가 m인 벡터
- Allocation : 각 프로세스에 현재 할당된 각 형태의 자원 수를 표시하는 n * m 행렬
- Request : 각 프로세스의 현재 요청을 표시하는 n * m 행렬
- Request [i,j] : 프로세스 pi가 필요한 자원 수가 k 개라면 프로세스 pi는 자원 형태 rj의 자원을 k 개 더 요청한다.
---
- 남아있는 프로세서들에 대한 할당 가능 순서를 모두 찾는다.
> 1단계 : Work, Finish 각각 길이가 m, n 벡터로, 'Work : Available'로 초기화 한다. (i = 1, 2...n)일 때 Allocation 0 이 아니면 Finish[i] = false이고 아니면 Finish[i] = true  
2단계 : 다음과 같은 조건을 만족하는 색인 i를 찾으며, 조건에 맞는 i가 없으면 4단계로 이동 Finish[i] = false Request <= Work  
3단계 : 다음이 일치하는지 여부를 판단하여 2단계로 이동 Work := Work + Allocation Finish[i] = true  
4단계 : Finish[i] = false 라면, 1 <= i <= m 인 범위에서 시스템과 프로세스는 pi는 교착상태 

- 교착상태 탐지 알고리즘
> p0에서 p4까지의 프로세스 5개와 자원 형태 3개, a,b,c를 가진 시스템이 있다고 가정한다.  
자원 형태 a는 자원을 7개, 자원 형태 b는 2개, c는 6개를 가지고 있다.  
t0 시간에 다음과 같은 자원 할당 상태가 된다 가정한다.  
프로세스 p2가 자원 형태 c의 자원을 1개 더 요청한다 가정한다.  
Request 행렬은 다음과 같이 수정한다.  
프로세스 p0이 점유하고 있는 자원을 요청하더라도 가용한 자원 수는 다른 프로세스들의 요청을 충족시킬 만큼 충분하지 않는다.  
따라서 프로세스 p1, p2, p3, p4로 구성된 교착상태가 존재한다.

- 교착상태 탐지 알고리즘 사용 횟수
> 탐지 알고리즘 호출 문제는 교착상태 발생 빈도수와 교착상태 발생 시 영향을 받는 프로세스의 수에 따라 결정한다.
  - 교착상태가 자주 발생하면 탐지 알고리즘도 자주 호출된다.
  - 요청을 할 때 마다 교착상태 탐지 알고리즘 호출 시 연산시간 부담이 크다.
  - 경제적인 방법은 호출 빈도를 줄이는 것으로, 한 시간마다 또는 CPU 이용률이 40%로 저하 될 때 마다 호출 

2. 교착상태 회복 기법 
- 교착상태에서 회복한다는 것은 순환대기에서 탈피한다는 것을 의미한다.
  - 프로세스를 한 개 이상 중지 시키는 방법
  - 교착상태의 프로세스들로부터 자원을 선정하는 방법

- 프로세스 중지
 - 두 가지 방법이 있으며, 모두 시스템이 정지된 프로세스에 할당된 모든 자원의 해제를 요구한다.
 - 교착상태 프로세스를 모두 중지
   - 교착상태의 순환대기를 확실히 해결하지만 자원 사용과 시간면에서 비용이 많이 든다.
   - 오랫동안 연산했을 가능성이 있는 프로세스의 부분 결과를 폐기하여 나중에 다시 연산한다.

- 한 프로세스 씩 중지 
  - 한 프로세스가 중지될 때 마다 교착상태 탐지 알고리즘을 호출하여 프로세스가 교착상태에 있는지 확인한다.
  - 교착상태 탐지 알고리즘 호출에 대한 부담이 크다.

- 부분 종료 방식을 사용하여 교착상태 회복
  - 어느 프로세스를 중지시킬지 결정해야하며, 이는 프로세서 스케줄링과 유사한 정책 결정 문제
  - 경제적인 문제로, 프로세서들을 중지시키는데 최소비용으로 중지시키는 방법을 찾아야한다.
  - 프로세스 선정 기준
    - 프로세스들의 우선순위
    - 프로세스가 수행된 시간과 앞으로 종요하는데 필요한 시간
    - 프로세스가 사용한 자원 형태와 수 
    - 프로세스 종료를 위해 필요한 자원 수 
    - 프로세스를 종료하는데 필요한 프로세스의 수 
    - 프로세스가 대화식인지 일괄식인지 여부 

- 자원 선점
  - 프로세스의 자원을 선점하여 교착상태가 해결될 때 까지 선점한 자원을 다른 프로세스에 할당하여 이용 
