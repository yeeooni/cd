# 단일 프로세서 스케쥴링(1)

- 개념
  - 스케쥴링은 시스템의 목표를 달성할 수 있도록 프로세서를 할당하는 일련의 과정
  - 프로세서의 효율성을 높이고 시스템의 작업 처리 능력을 향상시키며 작업의 응답 시간 최소화

- 다중 프로그래밍
  - 운영체제에서 가장 중요한 개념으로 여러 작업을 동시에 처리
  - 여러 프로그램을 메인 메모리에 적재, 프로세서를 분할 하여 시스템 효율성을 향상
  - 장점 : 프로세서 이용률을 높일 수 있다. 프로세서 처리율 증가 
  - 실행 과정
    - 프로세스 A, B 각각 1초씩 실행하고 1초 기다리는 것을 60회 반복한다 가정
    - 프로세스 A를 모두 처리한 후 프로세스 B를 처리하면, 작업에 4분 소요
    - 컴퓨터가 실제 작업을 처리하는 시간 2분, 쉬는 시간 2분 소요
    - 프로세스 A, B 다중 프로그래밍하여 시스템 성능 향상
    - A를 먼저 실행하고 1초 후 B 실행

- 기본 요소
  - 프로세스 실행
  - 컴퓨터 시스템에서 발생한 다양한 프로세스는 스케쥴링 해야하는 것, 그렇지 않은 것으로 구분한다.
  - 스케쥴링 하지 않고 실행 : 인터럽트 처리, 오류 처리, 사용자의 시스템 호출 등 사전 처리
  - 스케쥴링 해야하는 것 : 사용자 프로세스, 시스템 프로세스
  - 다중 작업 (Multi task)
    - 다중 프로그래밍과 상관 없이 여러 개의 프로세스가 동시 실행되는 경우
    - 스풀링 등의 시스템 프로세스에 의해 단일 사용자 시스템에서도 여러 개의 프로세스가 동시에 실행 가능 
  - 프로세스의 실행은 실행(프로세서 버스트), 입출력 대기의 순환으로 구성
    - 프로세스들은 두 상태 사이에서 교대로 진행
    - 프로세서 버스트, 즉 프로세서에서 실행되고 있는

**프로세서 버스트**
- 프로세서 버스트 지속시간을 측정하면 전체적인 발생시간이 빈도 곡선으로 표시된다.
- 프로세스의 입출력 대기 시간
  - 긴 프로세서 버스트(a), 짧은 프로세서 버스트(b)를 갖는 전형적인 입출력 대기 시간을 나타낸다.
  - 입출력 중심의 프로그램은 전형적으로 매우 짧은 프로세스 버스트를 가진다.
  - 프로세서 중심의 프로그램은 매우 긴 프로세서 버스트를 가진다.
  - 이런 분포는 적절한 프로세서 스케쥴링 알고리즘을 선택하는데 매우 중요 기준이 된다.

- 단계
  - 프로세스들을 언제, 어느 프로세서에 할당한 것인가를 결정한다.
  - 1 : 작업 스케쥴링(작업 선택) - 승인 스케쥴링 / 시스템 자원을 실제 사용할 작업을 결정하는 단계 / 수행 빈도로 표현하여 장기 스케쥴링 / 새로운 프로세스가 생성되면 실행되고, 작업 스케쥴링 수행되면 작업은 프로세스들로 나누어진다.

  - 2 : 작업 승인과 프로세서 할당 - 어느 프로세스에 프로세서 사용 권한을 줄 지 결정 / 시스템의 부하가 변동함에 따라 어느 프로세스를 잠정적으로 연기시킬 것인지 결정 / 시스템의 작업 승인과 작업들에 대한 프로세서 배당 사이의 완충 역할 / 수행 빈도로 표현하여 중기 스케쥴링으로 교체 가능의 일보로 이해 가능 / 실행 가능한

  - 3 : 준비상태의 프로세서에 프로세스 할당(디스패치) - 디스패치에 의해 준비상태에 있는 프로세스의 프로세서를 어느 프로세스에 할당할 지 결정 

**대기 중인 프로세스 선택과 프로세스에 프로세서를 할당하는 작업으로 다음 사항을 고려**
- 자원 할당의 공정성 : 모든 프로세스를 공평하게 취급해야 하며 어느 프로세스도 무한정 실행이 연기되어서는 안된다.
- 단위 시간당 처리량 : 단위 시간당 유효시간을 줄이고 프로세서의 처리량을 최대화하여 가능한 많은 프로세스에 서비스를 제공
- 응답시간 : 적절한 시간 내에 응답을 하며, 대화식 사용자에게는 적어도 2 ~ 3초 이내에 응답해야한다.
- 예측 가능성 : 시스템 부하에 관계없이 작업은 거의 같은 시간 내에 거의 같은 비용으로 실행 가능해야한다.
- 과부하 : 과부하가 발생하면 자원이 낭비되므로 과부하를 줄여야한다. 과부하는 시스템의 전반적인 성능을 향상시킬 수 있다.
- 자원사용의 균형 : 시스템 내의 자원들은 가능한 쉬지 않고 사용할 수 있도록 스케줄링 해야 한다. 유휴상태의 자원을 사용하려는 프로세스에 특별한 혜택 부여 가능.
- 응답시간과 자원의 활용 간에 균형 유지 : 응답시간을 빠르게 하는 방법은 자원들이 필요할 때마다 이용할 수 있도록 충분한 자원을 확보하는 것이나, 자원이 충분할 경우 자원 활용도가 낮아진다. 실시간 시스템에서는 빠른 응답이 필수라 자원 활용이 덜 중요하나, 다른 형태의 시스템에서는 경제성으로 인해 효과적인 자원 활용이 주요
- 실행 대기 : 실행의 무한정 연기는 교착상태만큼 나쁜 영향을 끼치므로 실행이 연기되는 것을 피해야 한다. 자원을 오래 기다릴 수록 높은 우선 순위를 부여하여, 자원을 확보하게 해주는 _에이징 방법_을 통해 해결 가능하다.
- 우선 순위 : 프로세스들에 우선 순위를 부여, 우선 순위가 높은 프로세스를 먼저 실행시킬 수 있도록 우선 순위 제도로 실행/ 비선점 자원일 경우, 스케줄링 기법은 프로세스에 주요 자원을 넘겨주기 보다 우선 순위에 따라 처리해야한다.
- 서비스 사용 기회 : 프로세스에 서비스 사용 기회를 자주 제공. 특히 페이지 부재율이 적은 프로세스들에 대해 서비스가 확대되어야 한다.
- 서비스 수 : 시스템에 부하가 많이 걸린 경우에 갑자기 서비스 수가 감소하면 안된다. 과부하를 방지하던지, 프로세스들의 서비스를 줄여 과부하에 대처, 서로 모순되는 면이 많이 있어 스케줄링 문제를 어렵게 만드는 원인 중 하나이다.

**스케줄링 큐**
- 스케줄링을 위한 데이터베이스는 큐로 구성, PCD가 리스트 형태로 연결
  - 프로세서 사용의 극대화를 위해 프로세스가 항상 실행될 수 있도록 준비 큐에 프로세스 적재
  - 단일 프로세서 시스템에서는 프로세스 하나만 수행되므로 여러 프로세스가 준비 큐에 저장

**준비 큐**
- 프로세스를 선택하는 큐로서 시스템에 하나 존재
- 일반적으로 준비 큐는 연결리스트로 머리와 꼬리 부분은 PCD 목록의 첫 번째 항목과 마지막 항목의 포인터를 가리킨다.
- PCD에는 준비 큐에 있는 다음 프로세스를 가리키는 포인터 필드가 있다.
- 시스템에는 장치와 연결된 다른 큐들이 존재 
- 프로세스가 프로세서를 할당 받으면 실행을 완료하고 종료, 입출력을 요청할 경우 대기
- 디스크는 동시에 많은 프로세스의 입출력 요청을 받을 수 있으나, 이 경우 프로세스 대기 발생

**장비 큐**
- 입출력 장치를 사용하기 위해 대기하는 프로세스들의 리스트
- 전용장치일 경우 장치큐는 프로세스를 한 개 이상 가질 수 없다.

**큐잉 도표**
- 프로세서 스케줄링 설명을 위해 사용한다.
  - 큐잉 도표에서 사각형은 큐로 준비 큐와 장치 큐의 집합을 의미
  - 원은 큐를 서비스하는 자원, 화살표는 시스템에서 프로세스들의 흐름을 표현
  - 작업 스케줄러가 작업을 받아들일 때, 작업의 PCB가 생성, PCB는 작업이 시작되어 종료될때까지 내용이 갱신된다.
  - 실행 준비가 된 PCB, 즉 해당 프로세서는 준비 큐에 놓인다.
  - 프로세스는 프로세서를 할당 받을 때까지 준비 큐에서 대기
  - 프로세스에 프로세서가 할당되면 다음과 같은 경우 발행 가능
    - 프로세서는 입출력 요청을 발신하고 입출력 큐에 놓인다.
    - 프로세스는 새로운 프로세스를 생성하고 생성한 프로세스의 종료를 기다린다.
    - 인터럽트에 의해 프로세서에서 강제로 제거된 프로세스는 준비 큐에 다시 놓일 수 있다.
  - 1, 2의 경우 프로세스는 대기상태에서 준비상태로 전환, 다시 준비 큐에 놓인다.
  - 프로세스는 종료되어 시스템을 떠날 때까지 순환을 계속한다.

**스케줄러**
- 스케줄링 큐에서 프로세스들을 선택하기 위해 스케줄러 사용
  - 프로세스는 실행되는 동안 다양한 스케줄링 큐 사이를 이동
  - 운영체제는 많은 스케줄러를 가지며, 주요 스케줄러는 장기 스케줄러, 단기 스케줄러
  - 장기 스케줄러 (작업 스케줄러)

- 일괄처리시스템에서 장기 스케줄러, 단기 스케줄러 비교
  - 일괄처리시스템에서는 즉시 처리할 수 있는 양보다 많은 작업이 들어온다.
  - 작업들은 저장 용량이 큰 저장장치에 저장되어있다.
  - 장기 스케줄러
  - 단기 스케줄러

- 차이점
  - 근본적인 차이점은 실행 빈도
  - 단기 스케줄러 : 실행할 프로세스를 수시 선택, 프로세서에서 실행시간은 100만 분의 수초 정도, 프로세스를 선택하는데 100만 분의 1초가 걸릴 때 전체 시간의 9% 정도가 프로세서의 스케줄러에 소비
  - 장기 스케줄러 : 시스템에 새로운 작업이 들어오는 것은 분 단위이므로, 단기 스케줄러에 비해 상대적으로 드물게 수행, 다중 프로그래밍의 정도를 결정, 작업이 시스템에 들어오는 정도가 일정할 경우, 작업의 도착률과 작업을 끝내고 나가는 정도는 같게 된다. 작업이 시스템을 나갈 때만 실행되며 실행 간격이 상대적으로 길어, 실행시간이 길어도 영향을 별로 받지 않는다.
  - 대부분의 작업들은 입출력 중심 작업, 프로세서 중심 작업으로 구성
  - 시스템의 성능을 좋게 하려면 두 종류의 작업을 적절히 혼합하여 사용

- 중기 스케줄러
  - 시스템에 장기 스케줄러가 없거나 작은 경우도 있으며, 시분할시스템은 장기 스케줄러 없이 새로운 프로세스를 메인 메모리에 넣어주기 한다.
  - 가상메모리체제나 시분할기법을 사용하는 시스템은 중기 스케줄러를 추가로 사용한다.
  - 교체 작업(SWAP) 작업 가능 : 프로세스들이 프로세서를 서로 차지하려고 할 때, 프로세스를 기억장소에서 빼낼 수 있어 다중 프로그래밍의 정도를 줄일 수 있다. 빼낸 프로세스는 시간이 흐른 후 다시 메인 메모리에 들어가 수행이 중단되었던 곳에서부터 계속 수행

- 디스패치(Dispatcher)
  - 프로세서 스케줄러에 포함된 요소로 분배기
  - 단기 스케줄러가 선택한 프로세스에 실질적으로 프로세서 할당
  - 프로세스의 레지스터를 적재하고, 사용자 상태로 전환, 다시 시작할 때 사용자 프로그램이 올바른 위치를 찾을 수 있도록 도와준다.
  - 디스패치의 속도는 빠를수록 좋다.

**선점 스케줄링과 비선점 스케줄링**
- 실행 중인 작업이나 프로세스를 실행 중 중단할 것인가? 의 관점을 기반으로 선점 스케줄링과 비선점 스케줄링으로 구분한다.
  - 비선점스케줄링 : 한 프로세스가 자원 선택 시, 다른 프로세스에 할당된 자원을 빼앗을 수 없는 스케줄링, 모든 프로세스를 공정하게 관리하여 실행시간 짧은 작업들을 기다리게 되는 경우가 있다. 우선 순위가 높은 작업들이 중간에 입력되어도 대기중인 작업들을 영향을 받지 않아 응답시간 예측이 쉽다.

  - 선점스케줄링 : 현재 실행중인 프로세스를 인터럽트 할 수 있거나 준비상태로 이동시킬 수 있는 스케줄링, 하나의 프로세스가 장시간 동안 프로세서를 독점하는 것을 방지, 우선 순위가 높은 프로세스들이 긴급한 처리를 요청할 때 유용하다. 선점을 효과적으로 하기 위해 메인 메모리에 많은 프로세스들이 저장되어 있어야 하므로 많은 오버헤드를 초래한다. 설계 시 우선 순위 개념을 반드시 고려하여 의미 있게 배당해야한다.

**알고리즘 성능 평가 기준**
- 스케줄링 알고리즘 선택 시, 각 알고리즘의 특성을 고려
- 다음과 같은 기준으로 프로세스 알고리즘 비교
  - 프로세서 사용률 : 프로세서를 실행상태로 항상 유지하여 유휴상태가 되지 않도록 한다.
  - 처리율
  - 반환시간 : 작업이 시스템에 맡겨져 메인 메모리에 들어가기까지의 시간, 준비 큐에 있는 시간
  - 대기시간 : 작업이 실행시간이나 입출력시간에는 실제적인 영향을 미치지 못하므로 준비 큐에서 가다리는 시간이 최소화되도록 사용자 수 제한
  - 반응시간 : 의뢰한 시간에서부터 반응이 시작되는 시간까지의 간격, 대화형시스템에 중요한 사항으로, 대화식 작업을 우선 처리, 일괄처리작업은 대화식 작업의 요구가 없을 때 처리 




